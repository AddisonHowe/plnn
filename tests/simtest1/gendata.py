import os
import numpy as np

OUTDIR = "tests/simtest1/data_train"
# OUTDIR = "tests/simtest1/data_valid"

# Dataset 1
d1 = {
    'ts' : [0., 2e-1,],
    'xs' : [[[0,0],[0,1],[1,0],[1,1]],
            [[0,0],[0,1],[1,0],[1,1]],],
    'p_params' : [10,0,1,10,10],
    'ps' : [[0,1],[0,1]],
    'dt' : 1e-1,
    'sigma' : 0.0,
    'x1hat_1' : [
        [-1., -1.5],
        [-0.044140338274827065, 0.983996950996011],
        [0.4880550017199511, -0.3716346976270708],
        [0.6004093354104088, 0.8988381884309824],
    ],
    'x1hat_2' : [
        [-1.3995546672681125, -1.59996827948497],
        [-0.0626632428626214, 0.9698985515881354],
        [-0.5009503591221932, -1.0857437150310814],
        [0.21368698703606587, 0.7959526079869289],
    ],
    'dLoss_dW1' : [[-0.2815739969037472, 0.09054238796914803], [0.06926051796239319, 0.4428884169281233], [-0.23879709404729596, 0.05918555291336286]],
    'dLoss_dW2' : [[1.2811123407952945, 1.0990177234901422, 1.1883896166816506], [1.0556834399241273, 0.8673919379207944, 0.6668879413667135], [0.16272187846209152, 0.1363561924372636, 0.1379825811555211]],
    'dLoss_dW3' : [[-0.03543713709006013, 0.3459426194409243, 0.40593075540624607]],
    'dLoss_dWT' : [[0, 0.4596296121659854], [0, 0.3776090220414218]],
    'e2_dLoss_dW1' : [[-0.14920277437805773, 0.05223877661368784], [0.016785026167711353, 0.39974809589818266], [-0.11370914646221716, 0.002185004261812229]],
    'e2_dLoss_dW2' : [[0.7765455088862223, 0.6657602174823316, 0.6989707908745685], [1.0110877888081755, 0.7078157326648529, 0.43042417549061074], [0.16195798996801705, 0.14793848121195521, 0.1439590651940763]],
    'e2_dLoss_dW3' : [[0.05542820689947528, 0.24466183479376036, 0.32584360889717334]],
    'e2_dLoss_dWT' : [[0, 0.3379646264392183], [0, 0.3024621411981009]],
}

# Dataset 1.2
d2 = {
    'ts' : [2e-1, 4e-1,],
    'xs' : [[[1,1],[1,0],[0,1],[0,0]],
            [[1,1],[1,0],[0,1],[0,0]],],
    'p_params' : [10,0,1,10,10],
    'ps' : [[0,1],[0,1]],
    'dt' : 1e-1,
    'sigma' : 0.0,
    'x1hat_1' : [
        [0.6004093354104088, 0.8988381884309824],
        [0.4880550017199511, -0.3716346976270708],
        [-0.044140338274827065, 0.983996950996011],
        [-1., -1.5],
    ],
    'x1hat_2' : [
        [0.21368698703606587, 0.7959526079869289],
        [-0.5009503591221932, -1.0857437150310814],
        [-0.0626632428626214, 0.9698985515881354],
        [-1.3995546672681125, -1.59996827948497],
    ],
    'dLoss_dW1' : [[-0.2815739969037472, 0.09054238796914803], [0.06926051796239319, 0.4428884169281233], [-0.23879709404729596, 0.05918555291336286]],
    'dLoss_dW2' : [[1.2811123407952945, 1.0990177234901422, 1.1883896166816506], [1.0556834399241273, 0.8673919379207944, 0.6668879413667135], [0.16272187846209152, 0.1363561924372636, 0.1379825811555211]],
    'dLoss_dW3' : [[-0.03543713709006013, 0.3459426194409243, 0.40593075540624607]],
    'dLoss_dWT' : [[0, 0.4596296121659854], [0, 0.3776090220414218]],
    'e2_dLoss_dW1' : [[-0.14920277437805773, 0.05223877661368784], [0.016785026167711353, 0.39974809589818266], [-0.11370914646221716, 0.002185004261812229]],
    'e2_dLoss_dW2' : [[0.7765455088862223, 0.6657602174823316, 0.6989707908745685], [1.0110877888081755, 0.7078157326648529, 0.43042417549061074], [0.16195798996801705, 0.14793848121195521, 0.1439590651940763]],
    'e2_dLoss_dW3' : [[0.05542820689947528, 0.24466183479376036, 0.32584360889717334]],
    'e2_dLoss_dWT' : [[0, 0.3379646264392183], [0, 0.3024621411981009]],
}

# Dataset 2.1
d3 = {
    'ts' : [5e-1, 7e-1,],
    'xs' : [[[2,0],[2,1],[3,0],[3,1]],
            [[0,0],[0,1],[1,0],[1,1]],],
    'p_params' : [0,10,10,1,0],
    'ps' : [[1,0],[1,0]],
    'dt' : 1e-1,
    'sigma' : 0.0,
    'x1hat_1' : [
        [1.7854752646396566, 0.058167257286156175],
        [1.7999521688359792, 1.0998794871311688],
        [2.7980792475689444, 0.09427097395239788],
        [2.7999949618350772, 1.0999854719996658],
    ],
    'x1hat_2' : [
        [1.5691350773675232, 0.11229509427352521],
        [1.5999091678674615, 1.199771962662291],
        [2.596432932109873, 0.1893829081758233],
        [2.5999906488709557, 1.1999733763358282],
    ],
    'dLoss_dW1' : [[0.122485316919165, -0.0019042484366314566], [0.008292044284970077, 0.00009611344292562874], [-0.00038740953387757823, -0.000029932339032934814]],
    'dLoss_dW2' : [[-0.04239102120444567, -0.004327140201113874, -0.00291698947781339], [-0.023672200190222814, 0.0004841793057849563, 0.0013782059200143633], [-0.00359274017115397, -0.0024009582142728602, -0.002356110685551493]],
    'dLoss_dW3' : [[-0.02049619580650347, -0.00030988103583705497, 0.0012182754130679327]],
    'dLoss_dWT' : [[-0.6404555442837438, 0], [-0.08077338359642922, 0]],
    'e2_dLoss_dW1' : [[0.09767934657225127, -0.0012678313122768672], [0.008174203011023982, 0.00012434339048491725], [-0.0003678708934281074, -0.000030496852288108667]],
    'e2_dLoss_dW2' : [[-0.049643084298138504, -0.015626175375831698, -0.01429162092136471], [-0.028780148691875115, -0.0016689693217360507, -0.0006085579721062563], [-0.0034743638617170244, -0.0023243611307255923, -0.0022786706004138185]],
    'e2_dLoss_dW3' : [[-0.017407512792168744, 0.00013511536396929833, 0.0012046338880455478]],
    'e2_dLoss_dWT' : [[-0.6378193337384208, 0], [-0.08023482680782724, 0]],
}

# Dataset 2.2
d4 = {
    'ts' : [7e-1, 9e-1],
    'xs' : [[[3,0],[3,1],[2,0],[2,1]],
            [[1,0],[1,1],[0,0],[0,1]],],
    'p_params' : [0,10,10,1,0],
    'ps' : [[1,0],[1,0]],
    'dt' : 1e-1,
    'sigma' : 0.0,
    'x1hat_1' : [
        [2.7980792475689444, 0.09427097395239788],
        [2.7999949618350772, 1.0999854719996658],
        [1.7854752646396566, 0.058167257286156175],
        [1.7999521688359792, 1.0998794871311688],
    ],
    'x1hat_2' : [
        [2.596432932109873, 0.1893829081758233],
        [2.5999906488709557, 1.1999733763358282],
        [1.5691350773675232, 0.11229509427352521],
        [1.5999091678674615, 1.199771962662291],
    ],
    'dLoss_dW1' : [[0.122485316919165, -0.0019042484366314566], [0.008292044284970077, 0.00009611344292562874], [-0.00038740953387757823, -0.000029932339032934814]],
    'dLoss_dW2' : [[-0.04239102120444567, -0.004327140201113874, -0.00291698947781339], [-0.023672200190222814, 0.0004841793057849563, 0.0013782059200143633], [-0.00359274017115397, -0.0024009582142728602, -0.002356110685551493]],
    'dLoss_dW3' : [[-0.02049619580650347, -0.00030988103583705497, 0.0012182754130679327]],
    'dLoss_dWT' : [[-0.6404555442837438, 0], [-0.08077338359642922, 0]],
    'e2_dLoss_dW1' : [[0.09767934657225127, -0.0012678313122768672], [0.008174203011023982, 0.00012434339048491725], [-0.0003678708934281074, -0.000030496852288108667]],
    'e2_dLoss_dW2' : [[-0.049643084298138504, -0.015626175375831698, -0.01429162092136471], [-0.028780148691875115, -0.0016689693217360507, -0.0006085579721062563], [-0.0034743638617170244, -0.0023243611307255923, -0.0022786706004138185]],
    'e2_dLoss_dW3' : [[-0.017407512792168744, 0.00013511536396929833, 0.0012046338880455478]],
    'e2_dLoss_dWT' : [[-0.6378193337384208, 0], [-0.08023482680782724, 0]],
}

DATA = [d1, d2, d3, d4]

for simidx, d in enumerate(DATA):
    simdir = f"{OUTDIR}/sim{simidx}"
    os.makedirs(simdir, exist_ok=True)
        
    # parse dictionary and construct arrays
    ts = np.array(d['ts'])
    xs = np.array(d['xs'])
    p_params = np.array(d['p_params'])
    ps = np.array(d['ps'])
    x1hat_1 = np.array(d['x1hat_1'])
    x1hat_2 = np.array(d['x1hat_2'])
    dloss_dw1 = np.array(d['dLoss_dW1'])
    dloss_dw2 = np.array(d['dLoss_dW2'])
    dloss_dw3 = np.array(d['dLoss_dW3'])
    dloss_dwt = np.array(d['dLoss_dWT'])
    e2_dloss_dw1 = np.array(d['e2_dLoss_dW1'])
    e2_dloss_dw2 = np.array(d['e2_dLoss_dW2'])
    e2_dloss_dw3 = np.array(d['e2_dLoss_dW3'])
    e2_dloss_dwt = np.array(d['e2_dLoss_dWT'])
    
    np.save(f"{simdir}/ts.npy", ts)
    np.save(f"{simdir}/xs.npy", xs)
    np.save(f"{simdir}/ps.npy", ps)
    np.save(f"{simdir}/p_params.npy", p_params)
    np.save(f"{simdir}/x1hat_1.npy", x1hat_1)
    np.save(f"{simdir}/x1hat_2.npy", x1hat_2)
    np.save(f"{simdir}/dloss_dw1.npy", dloss_dw1)
    np.save(f"{simdir}/dloss_dw2.npy", dloss_dw2)
    np.save(f"{simdir}/dloss_dw3.npy", dloss_dw3)
    np.save(f"{simdir}/dloss_dwt.npy", dloss_dwt)
    np.save(f"{simdir}/e2_dloss_dw1.npy", e2_dloss_dw1)
    np.save(f"{simdir}/e2_dloss_dw2.npy", e2_dloss_dw2)
    np.save(f"{simdir}/e2_dloss_dw3.npy", e2_dloss_dw3)
    np.save(f"{simdir}/e2_dloss_dwt.npy", e2_dloss_dwt)
